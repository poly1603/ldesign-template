{"version":3,"file":"TemplatePlugin.js","sources":["../../src/plugin/TemplatePlugin.ts"],"sourcesContent":["import type { App, Plugin } from 'vue'\r\nimport { TemplateRegistry, TemplateManager } from '@ldesign/template-core'\r\nimport type { TemplateMetadata } from '@ldesign/template-core'\r\nimport { createTemplateScanner } from '../scanner'\r\nimport { setTemplateManager } from './context'\r\n\r\n/**\r\n * 模板插件选项\r\n */\r\nexport interface TemplatePluginOptions {\r\n  /**\r\n   * 是否自动扫描模板\r\n   * @default true\r\n   */\r\n  autoScan?: boolean\r\n\r\n  /**\r\n   * 初始模板列表\r\n   */\r\n  templates?: TemplateMetadata[]\r\n\r\n  /**\r\n   * 是否启用调试模式\r\n   * @default false\r\n   */\r\n  debug?: boolean\r\n}\r\n\r\n/**\r\n * 创建模板插件\r\n */\r\nexport function createTemplatePlugin(\r\n  options: TemplatePluginOptions = {}\r\n): Plugin {\r\n  const { autoScan = true, templates = [], debug = false } = options\r\n\r\n  return {\r\n    install(app: App) {\r\n      // 创建注册表和管理器\r\n      const registry = new TemplateRegistry()\r\n      const manager = new TemplateManager(registry)\r\n\r\n      // 自动扫描模板\r\n      if (autoScan) {\r\n        try {\r\n          const scanner = createTemplateScanner()\r\n          const scannedTemplates = scanner.scan()\r\n          \r\n          if (debug) {\r\n            console.log('[TemplatePlugin] 扫描到的模板:', scannedTemplates)\r\n            console.log('[TemplatePlugin] 扫描统计:', scanner.getStats())\r\n          }\r\n          \r\n          registry.registerBatch(scannedTemplates)\r\n        } catch (error) {\r\n          console.error('[TemplatePlugin] 模板扫描失败:', error)\r\n        }\r\n      }\r\n\r\n      // 注册预定义模板\r\n      if (templates.length > 0) {\r\n        registry.registerBatch(templates)\r\n        if (debug) {\r\n          console.log('[TemplatePlugin] 注册预定义模板:', templates.length)\r\n        }\r\n      }\r\n\r\n      // 设置全局管理器\r\n      setTemplateManager(manager)\r\n\r\n      // 提供给组件使用\r\n      app.provide('templateManager', manager)\r\n\r\n      // 全局属性\r\n      app.config.globalProperties.$templates = manager\r\n\r\n      if (debug) {\r\n        console.log('[TemplatePlugin] 插件已安装')\r\n        console.log('[TemplatePlugin] 总模板数:', manager.getTemplateCount())\r\n      }\r\n    },\r\n  }\r\n}"],"names":["createTemplatePlugin","options","autoScan","templates","debug","install","app","registry","TemplateRegistry","manager","TemplateManager","scanner","createTemplateScanner","scannedTemplates","scan","console","log","getStats","registerBatch","error","length","setTemplateManager","provide","config","globalProperties","$templates","getTemplateCount"],"mappings":";;;;;;;;;;;;;AA+BO,SAASA,oBAAAA,CACdC,OAAAA,GAAiC,EAAC,EAC1B;AACR,EAAA,MAAM;AAAA,IAAEC,QAAAA,GAAW,IAAA;AAAA,IAAMC,YAAY,EAAA;AAAA,IAAIC,KAAAA,GAAQ;AAAA,GAAM,GAAIH,OAAAA;AAE3D,EAAA,OAAO;AAAA,IACLI,QAAQC,GAAAA,EAAU;AAEhB,MAAA,MAAMC,QAAAA,GAAW,IAAIC,gBAAAA,EAAiB;AACtC,MAAA,MAAMC,OAAAA,GAAU,IAAIC,eAAAA,CAAgBH,QAAQ,CAAA;AAG5C,MAAA,IAAIL,QAAAA,EAAU;AACZ,QAAA,IAAI;AACF,UAAA,MAAMS,UAAUC,qBAAAA,EAAsB;AACtC,UAAA,MAAMC,gBAAAA,GAAmBF,QAAQG,IAAAA,EAAK;AAEtC,UAAA,IAAIV,KAAAA,EAAO;AACTW,YAAAA,OAAAA,CAAQC,GAAAA,CAAI,0DAA4BH,gBAAgB,CAAA;AACxDE,YAAAA,OAAAA,CAAQC,GAAAA,CAAI,4CAAA,EAA0BL,OAAAA,CAAQM,QAAAA,EAAU,CAAA;AAAA,UAC1D;AAEAV,UAAAA,QAAAA,CAASW,cAAcL,gBAAgB,CAAA;AAAA,QACzC,SAASM,KAAAA,EAAO;AACdJ,UAAAA,OAAAA,CAAQI,KAAAA,CAAM,0DAA4BA,KAAK,CAAA;AAAA,QACjD;AAAA,MACF;AAGA,MAAA,IAAIhB,SAAAA,CAAUiB,SAAS,CAAA,EAAG;AACxBb,QAAAA,QAAAA,CAASW,cAAcf,SAAS,CAAA;AAChC,QAAA,IAAIC,KAAAA,EAAO;AACTW,UAAAA,OAAAA,CAAQC,GAAAA,CAAI,8DAAA,EAA6Bb,SAAAA,CAAUiB,MAAM,CAAA;AAAA,QAC3D;AAAA,MACF;AAGAC,MAAAA,kBAAAA,CAAmBZ,OAAO,CAAA;AAG1BH,MAAAA,GAAAA,CAAIgB,OAAAA,CAAQ,mBAAmBb,OAAO,CAAA;AAGtCH,MAAAA,GAAAA,CAAIiB,MAAAA,CAAOC,iBAAiBC,UAAAA,GAAahB,OAAAA;AAEzC,MAAA,IAAIL,KAAAA,EAAO;AACTW,QAAAA,OAAAA,CAAQC,IAAI,iDAAwB,CAAA;AACpCD,QAAAA,OAAAA,CAAQC,GAAAA,CAAI,4CAAA,EAA0BP,OAAAA,CAAQiB,gBAAAA,EAAkB,CAAA;AAAA,MAClE;AAAA,IACF;AAAA,GACF;AACF;;;;;;;"}