{"version":3,"file":"useTemplateList.js","sources":["../../src/composables/useTemplateList.ts"],"sourcesContent":["import { ref, computed, type Ref, type ComputedRef } from 'vue'\r\nimport type { TemplateMetadata, DeviceType } from '@ldesign/template-core'\r\nimport { getTemplateManager } from '../plugin/context'\r\n\r\n/**\r\n * useTemplateList 返回值\r\n */\r\nexport interface UseTemplateListReturn {\r\n  /**\r\n   * 模板列表\r\n   */\r\n  templates: Ref<TemplateMetadata[]>\r\n\r\n  /**\r\n   * 加载状态\r\n   */\r\n  loading: Ref<boolean>\r\n\r\n  /**\r\n   * 模板数量\r\n   */\r\n  count: ComputedRef<number>\r\n\r\n  /**\r\n   * 刷新列表\r\n   */\r\n  refresh: () => void\r\n\r\n  /**\r\n   * 按标签过滤\r\n   */\r\n  filterByTag: (tag: string) => TemplateMetadata[]\r\n\r\n  /**\r\n   * 搜索模板\r\n   */\r\n  search: (keyword: string) => TemplateMetadata[]\r\n}\r\n\r\n/**\r\n * 使用模板列表 Composable\r\n * \r\n * @param category - 功能分类\r\n * @param device - 设备类型(可选)\r\n * @returns 模板列表和操作方法\r\n * \r\n * @example\r\n * ```ts\r\n * const { templates, count, refresh } = useTemplateList('login', 'desktop')\r\n * ```\r\n */\r\nexport function useTemplateList(\r\n  category: string | Ref<string>,\r\n  device?: DeviceType | Ref<DeviceType | undefined>\r\n): UseTemplateListReturn {\r\n  const templates = ref<TemplateMetadata[]>([])\r\n  const loading = ref(false)\r\n\r\n  const count = computed(() => templates.value.length)\r\n\r\n  /**\r\n   * 刷新列表\r\n   */\r\n  function refresh(): void {\r\n    loading.value = true\r\n\r\n    try {\r\n      const manager = getTemplateManager()\r\n      const cat = typeof category === 'string' ? category : category.value\r\n      const dev = device\r\n        ? typeof device === 'string'\r\n          ? device\r\n          : device.value\r\n        : undefined\r\n\r\n      if (dev) {\r\n        // 同时指定分类和设备\r\n        templates.value = manager.getTemplatesByCategoryAndDevice(cat, dev)\r\n      } else {\r\n        // 只指定分类\r\n        templates.value = manager.getTemplatesByCategory(cat)\r\n      }\r\n    } catch (error) {\r\n      console.error('获取模板列表失败:', error)\r\n      templates.value = []\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 按标签过滤\r\n   */\r\n  function filterByTag(tag: string): TemplateMetadata[] {\r\n    return templates.value.filter((template: TemplateMetadata) =>\r\n      template.tags?.includes(tag)\r\n    )\r\n  }\r\n\r\n  /**\r\n   * 搜索模板\r\n   */\r\n  function search(keyword: string): TemplateMetadata[] {\r\n    const lowerKeyword = keyword.toLowerCase()\r\n    return templates.value.filter(\r\n      (template: TemplateMetadata) =>\r\n        template.name.toLowerCase().includes(lowerKeyword) ||\r\n        template.displayName?.toLowerCase().includes(lowerKeyword) ||\r\n        template.description?.toLowerCase().includes(lowerKeyword) ||\r\n        template.tags?.some((tag: string) => tag.toLowerCase().includes(lowerKeyword))\r\n    )\r\n  }\r\n\r\n  // 初始加载\r\n  refresh()\r\n\r\n  return {\r\n    templates,\r\n    loading,\r\n    count,\r\n    refresh,\r\n    filterByTag,\r\n    search,\r\n  }\r\n}"],"names":["useTemplateList","category","device","templates","ref","loading","count","computed","value","length","refresh","manager","getTemplateManager","cat","dev","undefined","getTemplatesByCategoryAndDevice","getTemplatesByCategory","error","console","filterByTag","tag","filter","template","tags","includes","search","keyword","lowerKeyword","toLowerCase","name","displayName","description","some"],"mappings":";;;;;;;;;;;;AAmDO,SAASA,eAAAA,CACdC,UACAC,MAAAA,EACuB;AACvB,EAAA,MAAMC,SAAAA,GAAYC,GAAAA,CAAwB,EAAE,CAAA;AAC5C,EAAA,MAAMC,OAAAA,GAAUD,IAAI,KAAK,CAAA;AAEzB,EAAA,MAAME,KAAAA,GAAQC,QAAAA,CAAS,MAAMJ,SAAAA,CAAUK,MAAMC,MAAM,CAAA;AAKnD,EAAA,SAASC,OAAAA,GAAgB;AACvBL,IAAAA,OAAAA,CAAQG,KAAAA,GAAQ,IAAA;AAEhB,IAAA,IAAI;AACF,MAAA,MAAMG,UAAUC,kBAAAA,EAAmB;AACnC,MAAA,MAAMC,GAAAA,GAAM,OAAOZ,QAAAA,KAAa,QAAA,GAAWA,WAAWA,QAAAA,CAASO,KAAAA;AAC/D,MAAA,MAAMM,MAAMZ,MAAAA,GACR,OAAOA,WAAW,QAAA,GAChBA,MAAAA,GACAA,OAAOM,KAAAA,GACTO,KAAAA,CAAAA;AAEJ,MAAA,IAAID,GAAAA,EAAK;AAEPX,QAAAA,SAAAA,CAAUK,KAAAA,GAAQG,OAAAA,CAAQK,+BAAAA,CAAgCH,GAAAA,EAAKC,GAAG,CAAA;AAAA,MACpE,CAAA,MAAO;AAELX,QAAAA,SAAAA,CAAUK,KAAAA,GAAQG,OAAAA,CAAQM,sBAAAA,CAAuBJ,GAAG,CAAA;AAAA,MACtD;AAAA,IACF,SAASK,KAAAA,EAAO;AACdC,MAAAA,OAAAA,CAAQD,KAAAA,CAAM,qDAAaA,KAAK,CAAA;AAChCf,MAAAA,SAAAA,CAAUK,QAAQ,EAAA;AAAA,IACpB,CAAA,SAAC;AACCH,MAAAA,OAAAA,CAAQG,KAAAA,GAAQ,KAAA;AAAA,IAClB;AAAA,EACF;AAKA,EAAA,SAASY,YAAYC,GAAAA,EAAiC;AACpD,IAAA,OAAOlB,SAAAA,CAAUK,MAAMc,MAAAA,CAAO,CAACC,aAC7BA,QAAAA,CAASC,IAAAA,EAAMC,QAAAA,CAASJ,GAAG,CAC7B,CAAA;AAAA,EACF;AAKA,EAAA,SAASK,OAAOC,OAAAA,EAAqC;AACnD,IAAA,MAAMC,YAAAA,GAAeD,QAAQE,WAAAA,EAAY;AACzC,IAAA,OAAO1B,UAAUK,KAAAA,CAAMc,MAAAA,CACrB,CAACC,QAAAA,KACCA,SAASO,IAAAA,CAAKD,WAAAA,EAAY,CAAEJ,QAAAA,CAASG,YAAY,CAAA,IACjDL,QAAAA,CAASQ,WAAAA,EAAaF,WAAAA,GAAcJ,QAAAA,CAASG,YAAY,CAAA,IACzDL,QAAAA,CAASS,aAAaH,WAAAA,EAAY,CAAEJ,QAAAA,CAASG,YAAY,KACzDL,QAAAA,CAASC,IAAAA,EAAMS,IAAAA,CAAK,CAACZ,QAAgBA,GAAAA,CAAIQ,WAAAA,GAAcJ,QAAAA,CAASG,YAAY,CAAC,CACjF,CAAA;AAAA,EACF;AAGAlB,EAAAA,OAAAA,EAAQ;AAER,EAAA,OAAO;AAAA,IACLP,SAAAA;AAAAA,IACAE,OAAAA;AAAAA,IACAC,KAAAA;AAAAA,IACAI,OAAAA;AAAAA,IACAU,WAAAA;AAAAA,IACAM;AAAAA,GACF;AACF;;;;;;;"}