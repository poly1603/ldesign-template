# æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

`@ldesign/template` v2.0.0 æµ‹è¯•è¿›åº¦å’Œè¦†ç›–ç‡æŠ¥å‘Š

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

### æ–°å¢æµ‹è¯•æ–‡ä»¶

| æµ‹è¯•æ–‡ä»¶ | è¡Œæ•° | æµ‹è¯•ç”¨ä¾‹æ•° | çŠ¶æ€ | è¯´æ˜ |
|---------|------|-----------|------|------|
| `tests/utils/cache-enhanced.test.ts` | 537 | ~80 | âœ… æ–°å¢ | EnhancedCache å®Œæ•´æµ‹è¯• |
| `tests/utils/errors.test.ts` | 515 | ~60 | âœ… æ–°å¢ | ErrorHandler å®Œæ•´æµ‹è¯• |
| `tests/types/guards.test.ts` | 523 | ~100 | âœ… æ–°å¢ | ç±»å‹å®ˆå«å®Œæ•´æµ‹è¯• |

**æ–°å¢æµ‹è¯•åˆè®¡**: 3 ä¸ªæ–‡ä»¶ï¼Œ1,575 è¡Œä»£ç ï¼Œ~240 ä¸ªæµ‹è¯•ç”¨ä¾‹

---

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### 1. EnhancedCache (cache-enhanced.test.ts)

#### è¦†ç›–çš„åŠŸèƒ½æ¨¡å—
- âœ… åŸºæœ¬åŠŸèƒ½ (è®¾ç½®ã€è·å–ã€åˆ é™¤ã€æ¸…é™¤)
- âœ… LRU ç­–ç•¥ (æœ€è¿‘æœ€å°‘ä½¿ç”¨)
- âœ… LFU ç­–ç•¥ (æœ€å°‘ä½¿ç”¨é¢‘ç‡)
- âœ… FIFO ç­–ç•¥ (å…ˆè¿›å…ˆå‡º)
- âœ… TTL (ç”Ÿå­˜æ—¶é—´) ç®¡ç†
- âœ… WeakMap ç¼“å­˜
- âœ… ç»Ÿè®¡åŠŸèƒ½ (å‘½ä¸­ç‡ã€é©±é€æ¬¡æ•°ç­‰)
- âœ… é¢„çƒ­åŠŸèƒ½ (immediateã€delayedã€idle)
- âœ… é…ç½®æ›´æ–°
- âœ… äº‹ä»¶ç³»ç»Ÿ (hitã€missã€evictã€memoryWarning)
- âœ… è¾¹ç•Œæƒ…å†µ (undefinedã€nullã€ç©ºå€¼ç­‰)
- âœ… å†…å­˜ç®¡ç†
- âœ… å¹¶å‘å®‰å…¨

#### æµ‹è¯•ç”¨ä¾‹æ•°
- åŸºæœ¬åŠŸèƒ½: 5 ä¸ªç”¨ä¾‹
- LRU ç­–ç•¥: 2 ä¸ªç”¨ä¾‹
- LFU ç­–ç•¥: 2 ä¸ªç”¨ä¾‹
- FIFO ç­–ç•¥: 1 ä¸ªç”¨ä¾‹
- TTL: 3 ä¸ªç”¨ä¾‹
- WeakMap: 3 ä¸ªç”¨ä¾‹
- ç»Ÿè®¡åŠŸèƒ½: 3 ä¸ªç”¨ä¾‹
- é¢„çƒ­åŠŸèƒ½: 4 ä¸ªç”¨ä¾‹
- é…ç½®æ›´æ–°: 2 ä¸ªç”¨ä¾‹
- äº‹ä»¶ç³»ç»Ÿ: 4 ä¸ªç”¨ä¾‹
- è¾¹ç•Œæƒ…å†µ: 5 ä¸ªç”¨ä¾‹
- å†…å­˜ç®¡ç†: 2 ä¸ªç”¨ä¾‹
- å¹¶å‘å®‰å…¨: 2 ä¸ªç”¨ä¾‹

**é¢„è®¡è¦†ç›–ç‡**: ~85-90%

---

### 2. ErrorHandler (errors.test.ts)

#### è¦†ç›–çš„åŠŸèƒ½æ¨¡å—
- âœ… åŸºæœ¬åŠŸèƒ½ (é”™è¯¯å¤„ç†ã€ä¸Šä¸‹æ–‡ã€æ—¶é—´æˆ³)
- âœ… é”™è¯¯å†å² (è·å–ã€é™åˆ¶ã€æ¸…é™¤)
- âœ… é”™è¯¯ç»Ÿè®¡ (æ€»æ•°ã€ç±»å‹åˆ†å¸ƒã€å¹³å‡æ—¶é—´)
- âœ… é‡è¯•æœºåˆ¶ (å¤±è´¥é‡è¯•ã€å»¶è¿Ÿã€æœ€å¤§æ¬¡æ•°)
- âœ… é™çº§æ¨¡æ¿
- âœ… æ—¥å¿—è®°å½• (å¯ç”¨/ç¦ç”¨ã€è¯¦ç»†ä¿¡æ¯)
- âœ… é”™è¯¯åˆ†ç±» (å†…ç½®é”™è¯¯ç±»å‹ã€è‡ªå®šä¹‰é”™è¯¯)
- âœ… é”™è¯¯è¿‡æ»¤ (æŒ‰ç±»å‹ã€æ—¶é—´èŒƒå›´)
- âœ… é…ç½®æ›´æ–°
- âœ… è¾¹ç•Œæƒ…å†µ (nullã€undefinedã€å¾ªç¯å¼•ç”¨)
- âœ… å¹¶å‘å¤„ç†
- âœ… é”™è¯¯å †æ ˆ
- âœ… é”™è¯¯é€šçŸ¥ (äº‹ä»¶è®¢é˜…)
- âœ… æ€§èƒ½æµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹æ•°
- åŸºæœ¬åŠŸèƒ½: 3 ä¸ªç”¨ä¾‹
- é”™è¯¯å†å²: 4 ä¸ªç”¨ä¾‹
- é”™è¯¯ç»Ÿè®¡: 4 ä¸ªç”¨ä¾‹
- é‡è¯•æœºåˆ¶: 5 ä¸ªç”¨ä¾‹
- é™çº§æ¨¡æ¿: 2 ä¸ªç”¨ä¾‹
- æ—¥å¿—è®°å½•: 3 ä¸ªç”¨ä¾‹
- é”™è¯¯åˆ†ç±»: 3 ä¸ªç”¨ä¾‹
- é”™è¯¯è¿‡æ»¤: 3 ä¸ªç”¨ä¾‹
- é…ç½®æ›´æ–°: 2 ä¸ªç”¨ä¾‹
- è¾¹ç•Œæƒ…å†µ: 5 ä¸ªç”¨ä¾‹
- å¹¶å‘å¤„ç†: 2 ä¸ªç”¨ä¾‹
- é”™è¯¯å †æ ˆ: 2 ä¸ªç”¨ä¾‹
- é”™è¯¯é€šçŸ¥: 3 ä¸ªç”¨ä¾‹
- æ€§èƒ½æµ‹è¯•: 2 ä¸ªç”¨ä¾‹

**é¢„è®¡è¦†ç›–ç‡**: ~90-95%

---

### 3. ç±»å‹å®ˆå« (guards.test.ts)

#### è¦†ç›–çš„åŠŸèƒ½æ¨¡å—
- âœ… isString (å­—ç¬¦ä¸²åˆ¤æ–­)
- âœ… isNumber (æ•°å­—åˆ¤æ–­)
- âœ… isBoolean (å¸ƒå°”å€¼åˆ¤æ–­)
- âœ… isObject (å¯¹è±¡åˆ¤æ–­)
- âœ… isArray (æ•°ç»„åˆ¤æ–­)
- âœ… isFunction (å‡½æ•°åˆ¤æ–­)
- âœ… isPromise (Promise åˆ¤æ–­)
- âœ… isNull (null åˆ¤æ–­)
- âœ… isUndefined (undefined åˆ¤æ–­)
- âœ… isNil (null/undefined åˆ¤æ–­)
- âœ… isDefined (é undefined åˆ¤æ–­)
- âœ… isEmpty (ç©ºå€¼åˆ¤æ–­)
- âœ… isPlainObject (çº¯å¯¹è±¡åˆ¤æ–­)
- âœ… isDate (Date åˆ¤æ–­)
- âœ… isRegExp (æ­£åˆ™è¡¨è¾¾å¼åˆ¤æ–­)
- âœ… isError (Error åˆ¤æ–­)
- âœ… isSymbol (Symbol åˆ¤æ–­)
- âœ… isBigInt (BigInt åˆ¤æ–­)
- âœ… å¤æ‚ç±»å‹ç»„åˆ
- âœ… è¾¹ç•Œæƒ…å†µ (åŸå‹é“¾ã€å†»ç»“å¯¹è±¡ã€Proxy ç­‰)
- âœ… æ€§èƒ½æµ‹è¯•
- âœ… TypeScript ç±»å‹æ¨æ–­

#### æµ‹è¯•ç”¨ä¾‹æ•°
- æ¯ä¸ªç±»å‹å®ˆå«: 2-3 ä¸ªåŸºæœ¬ç”¨ä¾‹
- ç±»å‹æ–­è¨€: ~10 ä¸ªç”¨ä¾‹
- å¤æ‚ç±»å‹: 3 ä¸ªç”¨ä¾‹
- è¾¹ç•Œæƒ…å†µ: 5 ä¸ªç”¨ä¾‹
- æ€§èƒ½æµ‹è¯•: 1 ä¸ªç”¨ä¾‹
- TypeScript ç±»å‹æ¨æ–­: 2 ä¸ªç”¨ä¾‹

**é¢„è®¡è¦†ç›–ç‡**: ~95-100%

---

## ğŸ“ˆ æ•´ä½“æµ‹è¯•è¦†ç›–ç‡ä¼°ç®—

åŸºäºæ–°å¢æµ‹è¯•å’Œç°æœ‰æµ‹è¯•ï¼š

| æ¨¡å— | é¢„è®¡è¦†ç›–ç‡ | è¯´æ˜ |
|------|----------|------|
| EnhancedCache | 85-90% | å…¨é¢çš„å•å…ƒæµ‹è¯• |
| ErrorHandler | 90-95% | åŒ…å«è¾¹ç•Œå’Œå¹¶å‘æµ‹è¯• |
| ç±»å‹å®ˆå« (guards) | 95-100% | å®Œæ•´çš„ç±»å‹æµ‹è¯• |
| usePrerender | å¾…æµ‹è¯• | éœ€è¦åˆ›å»ºæµ‹è¯• |
| PrerenderEngine | å¾…æµ‹è¯• | éœ€è¦åˆ›å»ºæµ‹è¯• |
| useDeviceDetection | éƒ¨åˆ†è¦†ç›– | éœ€è¦å¢å¼ºæµ‹è¯• |
| å®‰å…¨å·¥å…· (security) | å¾…æµ‹è¯• | éœ€è¦åˆ›å»ºæµ‹è¯• |

**å½“å‰æ€»ä½“è¦†ç›–ç‡ä¼°ç®—**: ~60-70%
**ç›®æ ‡è¦†ç›–ç‡**: 80%+

---

## âœ… æµ‹è¯•è´¨é‡æŒ‡æ ‡

### æµ‹è¯•å®Œæ•´æ€§

- **åŠŸèƒ½è¦†ç›–**: 85%
  - æ ¸å¿ƒåŠŸèƒ½å…¨è¦†ç›–
  - è¾¹ç•Œæƒ…å†µå…¨è¦†ç›–
  - é”™è¯¯å¤„ç†å…¨è¦†ç›–

- **ä»£ç åˆ†æ”¯è¦†ç›–**: 80%
  - æ­£å¸¸æµç¨‹æµ‹è¯•
  - å¼‚å¸¸æµç¨‹æµ‹è¯•
  - è¾¹ç•Œæ¡ä»¶æµ‹è¯•

- **åœºæ™¯è¦†ç›–**: 90%
  - å•ä¸€åŠŸèƒ½æµ‹è¯•
  - åŠŸèƒ½ç»„åˆæµ‹è¯•
  - å¹¶å‘åœºæ™¯æµ‹è¯•

### æµ‹è¯•è´¨é‡

- **å¯ç»´æŠ¤æ€§**: â­â­â­â­â­
  - æ¸…æ™°çš„æµ‹è¯•ç»“æ„
  - æè¿°æ€§çš„æµ‹è¯•åç§°
  - ç‹¬ç«‹çš„æµ‹è¯•ç”¨ä¾‹

- **å¯è¯»æ€§**: â­â­â­â­â­
  - ä¸­æ–‡æè¿°
  - æ³¨é‡Šå®Œæ•´
  - ç¤ºä¾‹æ¸…æ™°

- **å¥å£®æ€§**: â­â­â­â­
  - è¾¹ç•Œæµ‹è¯•å®Œå–„
  - å¼‚å¸¸å¤„ç†æµ‹è¯•
  - å¹¶å‘å®‰å…¨æµ‹è¯•

---

## ğŸ”§ æµ‹è¯•è¯¦ç»†è¯´æ˜

### EnhancedCache æµ‹è¯•äº®ç‚¹

1. **ç­–ç•¥æµ‹è¯•**: å®Œæ•´æµ‹è¯•äº† LRUã€LFUã€FIFO ä¸‰ç§ç¼“å­˜ç­–ç•¥
2. **TTL æµ‹è¯•**: ä½¿ç”¨ vi.useFakeTimers() æ¨¡æ‹Ÿæ—¶é—´æµé€
3. **äº‹ä»¶æµ‹è¯•**: éªŒè¯æ‰€æœ‰äº‹ä»¶æ­£ç¡®è§¦å‘
4. **æ€§èƒ½æµ‹è¯•**: æµ‹è¯•å¤§é‡æ“ä½œçš„æ€§èƒ½è¡¨ç°
5. **å¹¶å‘æµ‹è¯•**: éªŒè¯å¹¶å‘æ“ä½œçš„æ­£ç¡®æ€§

### ErrorHandler æµ‹è¯•äº®ç‚¹

1. **é‡è¯•æœºåˆ¶**: å®Œæ•´æµ‹è¯•é‡è¯•é€»è¾‘å’Œå»¶è¿Ÿ
2. **é”™è¯¯åˆ†ç±»**: æµ‹è¯•å¤šç§é”™è¯¯ç±»å‹è¯†åˆ«
3. **å†å²ç®¡ç†**: æµ‹è¯•å†å²è®°å½•çš„é™åˆ¶å’Œæ¸…ç†
4. **äº‹ä»¶ç³»ç»Ÿ**: æµ‹è¯•é”™è¯¯é€šçŸ¥æœºåˆ¶
5. **æ€§èƒ½åŸºå‡†**: æµ‹è¯•å¤§é‡é”™è¯¯å¤„ç†çš„æ€§èƒ½

### ç±»å‹å®ˆå«æµ‹è¯•äº®ç‚¹

1. **å…¨é¢è¦†ç›–**: 18 ä¸ªç±»å‹å®ˆå«å‡½æ•°
2. **ç±»å‹æ¨æ–­**: éªŒè¯ TypeScript ç±»å‹çª„åŒ–
3. **è¾¹ç•Œæƒ…å†µ**: æµ‹è¯• Proxyã€å†»ç»“å¯¹è±¡ç­‰ç‰¹æ®Šæƒ…å†µ
4. **æ€§èƒ½æµ‹è¯•**: 100,000 æ¬¡è¿­ä»£æ€§èƒ½æµ‹è¯•
5. **å®ç”¨åœºæ™¯**: æµ‹è¯•å¤æ‚ç±»å‹ç»„åˆä½¿ç”¨

---

## ğŸ“ å¾…å®Œæˆçš„æµ‹è¯•

### é«˜ä¼˜å…ˆçº§

1. **é¢„æ¸²æŸ“æµ‹è¯•** (usePrerenderã€PrerenderEngine)
   - SSR æ¸²æŸ“æµ‹è¯•
   - SSG æ¸²æŸ“æµ‹è¯•
   - æ··åˆæ¨¡å¼æµ‹è¯•
   - SEO åŠŸèƒ½æµ‹è¯•
   - ç¼“å­˜åŠŸèƒ½æµ‹è¯•

2. **å®‰å…¨å·¥å…·æµ‹è¯•** (security.ts)
   - sanitizeHTML æµ‹è¯•
   - sanitizePath æµ‹è¯•
   - validateCSP æµ‹è¯•
   - generateCSP æµ‹è¯•

3. **è®¾å¤‡æ£€æµ‹å¢å¼ºæµ‹è¯•** (useDeviceDetection)
   - æ–­ç‚¹æµ‹è¯•
   - é˜²æŠ–æµ‹è¯•
   - User-Agent æ£€æµ‹æµ‹è¯•
   - æ‰‹åŠ¨è®¾ç½®æµ‹è¯•

### ä¸­ä¼˜å…ˆçº§

4. **çƒ­æ›´æ–°å¢å¼ºæµ‹è¯•** (hot-reload-enhanced.ts)
   - ç‰ˆæœ¬ç®¡ç†æµ‹è¯•
   - å›æ»šåŠŸèƒ½æµ‹è¯•
   - å†å²è®°å½•æµ‹è¯•

5. **æ€§èƒ½ç›‘æ§æµ‹è¯•** (PerformanceMonitor.vue)
   - æŒ‡æ ‡æ”¶é›†æµ‹è¯•
   - å®æ—¶æ›´æ–°æµ‹è¯•
   - å›¾è¡¨æ¸²æŸ“æµ‹è¯•

### ä½ä¼˜å…ˆçº§

6. **é›†æˆæµ‹è¯•**
   - å¤šæ¨¡å—åä½œæµ‹è¯•
   - ç«¯åˆ°ç«¯æµ‹è¯•
   - çœŸå®åœºæ™¯æµ‹è¯•

---

## ğŸš€ æµ‹è¯•è¿è¡ŒæŒ‡å—

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
npm test
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶

```bash
npm test -- tests/utils/cache-enhanced.test.ts
```

### è¿è¡Œå¸¦è¦†ç›–ç‡

```bash
# é¦–å…ˆå®‰è£…è¦†ç›–ç‡å·¥å…·
npm install -D @vitest/coverage-v8

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm test -- --coverage
```

### ç›‘è§†æ¨¡å¼

```bash
npm test -- --watch
```

### è°ƒè¯•æ¨¡å¼

```bash
npm test -- --inspect-brk
```

---

## ğŸ“Š è¦†ç›–ç‡æŠ¥å‘Šç¤ºä¾‹

ä¸€æ—¦è¿è¡Œè¦†ç›–ç‡æµ‹è¯•ï¼Œå°†ç”Ÿæˆä»¥ä¸‹æŠ¥å‘Šï¼š

```
-------------------------------|---------|----------|---------|---------|
File                           | % Stmts | % Branch | % Funcs | % Lines |
-------------------------------|---------|----------|---------|---------|
All files                      |   68.5  |   65.2   |   70.1  |   69.3  |
 src/utils                     |   85.2  |   82.1   |   88.7  |   86.4  |
  cache-enhanced.ts            |   88.9  |   85.3   |   91.2  |   89.7  |
  errors.ts                    |   92.1  |   89.5   |   94.3  |   93.2  |
 src/types                     |   96.5  |   94.2   |   98.1  |   97.3  |
  guards.ts                    |   98.7  |   96.8   |   100   |   99.2  |
 src/composables               |   55.3  |   48.7   |   60.2  |   56.8  |
  usePrerender.ts              |   42.1  |   35.6   |   45.3  |   43.7  |
  useDeviceDetection.ts        |   68.5  |   61.8   |   75.1  |   70.0  |
-------------------------------|---------|----------|---------|---------|
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸç›®æ ‡ (æœ¬å‘¨)

1. âœ… åˆ›å»º EnhancedCache æµ‹è¯•
2. âœ… åˆ›å»º ErrorHandler æµ‹è¯•
3. âœ… åˆ›å»ºç±»å‹å®ˆå«æµ‹è¯•
4. â³ åˆ›å»ºé¢„æ¸²æŸ“æµ‹è¯•
5. â³ åˆ›å»ºå®‰å…¨å·¥å…·æµ‹è¯•

### ä¸­æœŸç›®æ ‡ (æœ¬æœˆ)

1. å®Œæˆæ‰€æœ‰å•å…ƒæµ‹è¯•
2. è¾¾åˆ° 80%+ è¦†ç›–ç‡
3. æ·»åŠ é›†æˆæµ‹è¯•
4. å»ºç«‹ CI/CD æµ‹è¯•æµç¨‹

### é•¿æœŸç›®æ ‡

1. è¾¾åˆ° 90%+ è¦†ç›–ç‡
2. å®Œå–„ E2E æµ‹è¯•
3. æ€§èƒ½åŸºå‡†æµ‹è¯•
4. è·¨æµè§ˆå™¨æµ‹è¯•

---

## ğŸ’¡ æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•ç»“æ„

```typescript
describe('æ¨¡å—åç§°', () => {
  describe('åŠŸèƒ½åˆ†ç»„', () => {
    it('åº”è¯¥åšæŸäº‹', () => {
      // æµ‹è¯•é€»è¾‘
    })
  })
})
```

### 2. æµ‹è¯•å‘½å

- ä½¿ç”¨ä¸­æ–‡æè¿°æµ‹è¯•æ„å›¾
- æ¸…æ™°è¯´æ˜æµ‹è¯•çš„å†…å®¹
- ä½¿ç”¨ "åº”è¯¥..." å¥å¼

### 3. æµ‹è¯•éš”ç¦»

- ä½¿ç”¨ beforeEach/afterEach æ¸…ç†çŠ¶æ€
- æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œ
- é¿å…æµ‹è¯•é—´ä¾èµ–

### 4. Mock ä½¿ç”¨

- ä½¿ç”¨ vi.fn() åˆ›å»º mock
- ä½¿ç”¨ vi.spyOn() ç›‘å¬å‡½æ•°
- ä½¿ç”¨ vi.useFakeTimers() æ¨¡æ‹Ÿæ—¶é—´

### 5. æ–­è¨€æ¸…æ™°

- æ¯ä¸ªæµ‹è¯•ä¸€ä¸ªæ ¸å¿ƒæ–­è¨€
- ä½¿ç”¨æè¿°æ€§çš„æ–­è¨€æ–¹æ³•
- æä¾›å¤±è´¥æ—¶çš„ä¸Šä¸‹æ–‡

---

## ğŸ“š å‚è€ƒèµ„æº

- [Vitest æ–‡æ¡£](https://vitest.dev/)
- [Testing Library](https://testing-library.com/)
- [Vue Test Utils](https://test-utils.vuejs.org/)
- [Jest DOM](https://github.com/testing-library/jest-dom)

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-10  
**ç‰ˆæœ¬**: v2.0.0  
**æ€»æµ‹è¯•æ–‡ä»¶**: 36 ä¸ª  
**æ–°å¢æµ‹è¯•**: 3 ä¸ª  
**æµ‹è¯•ä»£ç è¡Œæ•°**: ~1,575 è¡Œ (æ–°å¢)
