{"version":3,"file":"templateDirective.js","sources":["../../src/directives/templateDirective.ts"],"sourcesContent":["/**\n * Vue Directive for Template Rendering\n * \n * Provides v-template directive as an alternative way to use templates\n * \n * Usage:\n * ```vue\n * <div v-template=\"{ category: 'login', device: 'desktop', name: 'default' }\"></div>\n * <div v-template:login.desktop.default></div>\n * <div v-template:login=\"{ device: 'mobile', name: 'card' }\"></div>\n * ```\n */\n\nimport type { App, Component, DirectiveBinding, VNode } from 'vue'\nimport type { DeviceType, TemplateLoadOptions } from '../types'\nimport { createApp, defineComponent, h, onUnmounted, ref, watchEffect } from 'vue'\nimport { getManager } from '../core/manager'\n\ninterface TemplateDirectiveOptions {\n  category: string\n  device?: DeviceType | string\n  name?: string\n  props?: Record<string, any>\n  slots?: Record<string, any>\n  loading?: Component | string\n  error?: Component | ((error: Error) => Component | string)\n  transition?: boolean | string\n  onLoad?: (component: Component) => void\n  onError?: (error: Error) => void\n}\n\ninterface TemplateDirectiveInstance {\n  app: App | null\n  component: Component | null\n  cleanup: () => void\n  abortController?: AbortController\n}\n\n// 使用 Map 而不是 WeakMap，以支持 forEach 遍历清理\n// 在 beforeunload 时会清理所有实例，所以不会造成内存泄漏\nconst instances = new Map<Element, TemplateDirectiveInstance>()\n\n/**\n * Parse directive arguments and modifiers\n */\nfunction parseBinding(binding: DirectiveBinding): TemplateDirectiveOptions {\n  const options: TemplateDirectiveOptions = {} as any\n\n  // Parse argument (e.g., v-template:login)\n  if (binding.arg) {\n    options.category = binding.arg\n  }\n\n  // Parse modifiers (e.g., v-template:login.desktop.default)\n  const modifiers = Object.keys(binding.modifiers)\n  if (modifiers.length > 0) {\n    if (modifiers[0]) options.device = modifiers[0] as DeviceType\n    if (modifiers[1]) options.name = modifiers[1]\n  }\n\n  // Parse value (overrides arg and modifiers)\n  if (typeof binding.value === 'object' && binding.value !== null) {\n    Object.assign(options, binding.value)\n  } else if (typeof binding.value === 'string') {\n    // Support string shorthand: \"category/device/name\"\n    const parts = binding.value.split('/')\n    if (parts[0]) options.category = parts[0]\n    if (parts[1]) options.device = parts[1] as DeviceType\n    if (parts[2]) options.name = parts[2]\n  }\n\n  // Set defaults\n  if (!options.device) options.device = detectDevice()\n  if (!options.name) options.name = 'default'\n\n  return options\n}\n\n/**\n * Detect current device type\n */\nfunction detectDevice(): DeviceType {\n  if (typeof window === 'undefined') return 'desktop'\n  const width = window.innerWidth\n  if (width < 768) return 'mobile'\n  if (width < 1024) return 'tablet'\n  return 'desktop'\n}\n\n/**\n * Create loading component\n */\nfunction createLoadingComponent(loading?: Component | string) {\n  if (loading) {\n    return typeof loading === 'string'\n      ? defineComponent({\n        render() {\n          return h('div', { class: 'v-template-loading' }, loading)\n        }\n      })\n      : loading\n  }\n\n  return defineComponent({\n    render() {\n      return h('div', { class: 'v-template-loading' }, [\n        h('span', { class: 'v-template-spinner' }, '加载中...')\n      ])\n    }\n  })\n}\n\n/**\n * Create error component\n */\nfunction createErrorComponent(error: Error, errorHandler?: Component | ((error: Error) => Component | string)) {\n  if (errorHandler) {\n    if (typeof errorHandler === 'function') {\n      const result = errorHandler(error)\n      return typeof result === 'string'\n        ? defineComponent({\n          render() {\n            return h('div', { class: 'v-template-error' }, result)\n          }\n        })\n        : result\n    }\n    return errorHandler\n  }\n\n  return defineComponent({\n    render() {\n      return h('div', { class: 'v-template-error' }, [\n        h('p', `加载模板失败: ${error.message}`),\n        h('button', {\n          class: 'v-template-retry',\n          onClick: () => window.location.reload()\n        }, '重试')\n      ])\n    }\n  })\n}\n\n/**\n * Mount template component to element\n */\nasync function mountTemplate(el: Element, options: TemplateDirectiveOptions) {\n  const manager = getManager()\n\n  // Clean up previous instance\n  unmountTemplate(el)\n\n  // Create abort controller for async operations\n  const abortController = new AbortController()\n\n  // Create container\n  const container = document.createElement('div')\n  container.className = 'v-template-container'\n\n  // Create reactive state\n  const isLoading = ref(true)\n  const loadError = ref<Error | null>(null)\n  const templateComponent = ref<Component | null>(null)\n\n  // Create wrapper component\n  const WrapperComponent = defineComponent({\n    setup() {\n      let stopWatcher: (() => void) | null = null\n\n      // Load template\n      stopWatcher = watchEffect(async (onInvalidate) => {\n        // Clean up on invalidation\n        onInvalidate(() => {\n          // Cancel any pending operations\n          if (abortController) {\n            abortController.abort()\n          }\n        })\n        try {\n          // Check if aborted\n          if (abortController?.signal.aborted) return\n\n          isLoading.value = true\n          loadError.value = null\n\n          const component = await manager.loadTemplate(\n            options.category,\n            options.device as string,\n            options.name!,\n            {\n              onLoad: options.onLoad,\n              onError: options.onError\n            } as TemplateLoadOptions\n          )\n\n          // Check again after async operation\n          if (abortController?.signal.aborted) return\n\n          templateComponent.value = component\n          isLoading.value = false\n        } catch (error) {\n          loadError.value = error as Error\n          isLoading.value = false\n          options.onError?.(error as Error)\n        }\n      })\n\n      // Clean up on unmount\n      onUnmounted(() => {\n        if (stopWatcher) {\n          stopWatcher()\n          stopWatcher = null\n        }\n        if (abortController) {\n          abortController.abort()\n        }\n      })\n\n      return () => {\n        // Show loading\n        if (isLoading.value) {\n          const LoadingComp = createLoadingComponent(options.loading)\n          return h(LoadingComp)\n        }\n\n        // Show error\n        if (loadError.value) {\n          const ErrorComp = createErrorComponent(loadError.value, options.error)\n          return h(ErrorComp)\n        }\n\n        // Show template\n        if (templateComponent.value) {\n          const content = h(templateComponent.value, options.props, options.slots)\n\n          // Add transition if requested\n          if (options.transition) {\n            const transitionName = typeof options.transition === 'string'\n              ? options.transition\n              : 'v-template-fade'\n\n            return h('transition', { name: transitionName }, () => content)\n          }\n\n          return content\n        }\n\n        return null\n      }\n    }\n  })\n\n  // Create and mount app\n  const app = createApp(WrapperComponent)\n\n  // Clear element content and append container\n  el.innerHTML = ''\n  el.appendChild(container)\n\n  // Mount app\n  app.mount(container)\n\n  // Store instance\n  instances.set(el, {\n    app,\n    component: WrapperComponent,\n    abortController,\n    cleanup: () => {\n      if (abortController) {\n        abortController.abort()\n      }\n      app.unmount()\n      if (container.parentNode) {\n        container.parentNode.removeChild(container)\n      }\n    }\n  })\n}\n\n/**\n * Unmount template from element\n */\nfunction unmountTemplate(el: Element) {\n  const instance = instances.get(el)\n  if (instance) {\n    instance.cleanup()\n    instances.delete(el)\n  }\n}\n\n/**\n * Template directive definition\n */\nexport const vTemplate = {\nmounted(el: Element, binding: DirectiveBinding, _vnode: VNode) {\n    const options = parseBinding(binding)\n\n    if (!options.category) {\n      console.error('[v-template] Category is required')\n      return\n    }\n\n    mountTemplate(el, options)\n  },\n\n  updated(el: Element, binding: DirectiveBinding) {\n    const oldOptions = parseBinding(binding.oldValue ?\n      { ...binding, value: binding.oldValue } : binding)\n    const newOptions = parseBinding(binding)\n\n    // Check if options changed\n    if (\n      oldOptions.category !== newOptions.category ||\n      oldOptions.device !== newOptions.device ||\n      oldOptions.name !== newOptions.name ||\n      JSON.stringify(oldOptions.props) !== JSON.stringify(newOptions.props)\n    ) {\n      mountTemplate(el, newOptions)\n    }\n  },\n\n  unmounted(el: Element) {\n    unmountTemplate(el)\n  }\n}\n\n// Track installed styles to avoid duplicates\nlet stylesInstalled = false\n\n/**\n * Install directive plugin\n */\nexport function installTemplateDirective(app: App) {\n  app.directive('template', vTemplate)\n\n  // Add global styles for directive (prevent duplicates)\n  if (typeof document !== 'undefined' && !stylesInstalled && !document.getElementById('v-template-styles')) {\n    stylesInstalled = true\n    const style = document.createElement('style')\n    style.id = 'v-template-styles'\n    style.textContent = `\n      .v-template-container {\n        width: 100%;\n        height: 100%;\n      }\n      \n      .v-template-loading {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        min-height: 200px;\n        color: #666;\n      }\n      \n      .v-template-spinner {\n        display: inline-block;\n        animation: v-template-spin 1s linear infinite;\n      }\n      \n      @keyframes v-template-spin {\n        from { transform: rotate(0deg); }\n        to { transform: rotate(360deg); }\n      }\n      \n      .v-template-error {\n        padding: 20px;\n        text-align: center;\n        color: #f56c6c;\n      }\n      \n      .v-template-retry {\n        margin-top: 10px;\n        padding: 8px 16px;\n        background: #409eff;\n        color: white;\n        border: none;\n        border-radius: 4px;\n        cursor: pointer;\n      }\n      \n      .v-template-retry:hover {\n        background: #66b1ff;\n      }\n      \n      /* Transition effects */\n      .v-template-fade-enter-active,\n      .v-template-fade-leave-active {\n        transition: opacity 0.3s ease;\n      }\n      \n      .v-template-fade-enter-from,\n      .v-template-fade-leave-to {\n        opacity: 0;\n      }\n      \n      .v-template-slide-enter-active,\n      .v-template-slide-leave-active {\n        transition: transform 0.3s ease;\n      }\n      \n      .v-template-slide-enter-from {\n        transform: translateX(-100%);\n      }\n      \n      .v-template-slide-leave-to {\n        transform: translateX(100%);\n      }\n    `\n    document.head.appendChild(style)\n\n    // Clean up on unload\n    window.addEventListener('beforeunload', () => {\n      // Clean up all instances\n      instances.forEach((instance, el) => {\n        unmountTemplate(el)\n      })\n    }, { once: true })\n  }\n}\n\n/**\n * Export for manual use\n */\nexport default vTemplate\n"],"names":["instances","Map","parseBinding","binding","options","arg","category","modifiers","Object","keys","length","device","name","value","assign","parts","split","detectDevice","window","width","innerWidth","createLoadingComponent","loading","defineComponent","render","h","class","createErrorComponent","error","errorHandler","result","message","onClick","location","reload","mountTemplate","el","manager","getManager","unmountTemplate","abortController","AbortController","container","document","createElement","className","isLoading","ref","loadError","templateComponent","WrapperComponent","setup","stopWatcher","watchEffect","onInvalidate","abort","signal","aborted","component","loadTemplate","onLoad","onError","onUnmounted","LoadingComp","ErrorComp","content","props","slots","transition","transitionName","app","createApp","innerHTML","appendChild","mount","set","cleanup","unmount","parentNode","removeChild","instance","get","delete","vTemplate","mounted","_vnode","console","updated","oldOptions","oldValue","newOptions","JSON","stringify","unmounted","stylesInstalled","installTemplateDirective","directive","getElementById","style","id","textContent","head","addEventListener","forEach","once"],"mappings":"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"}