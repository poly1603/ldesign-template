{"version":3,"file":"ConditionalTemplate.vue2.js","sources":["../../src/components/ConditionalTemplate.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport type { TemplateCondition, TemplateContext } from '../composables/useTemplateCondition'\nimport { onMounted, onUnmounted, ref, watch } from 'vue'\nimport { useTemplateCondition } from '../composables/useTemplateCondition'\nimport TemplateRenderer from './TemplateRenderer.vue'\nimport TemplateSkeleton from './TemplateSkeleton.vue'\n\n/**\n * 组件属性\n */\ninterface Props {\n  /** 条件列表 */\n  conditions?: TemplateCondition[]\n  /** 上下文 */\n  context?: TemplateContext\n  /** 默认模板 */\n  defaultTemplate?: string\n  /** 模板数据 */\n  data?: any\n  /** 自定义组件 */\n  customComponents?: Record<string, any>\n  /** 显示骨架屏 */\n  showSkeleton?: boolean\n  /** 显示调试信息 */\n  showDebug?: boolean\n  /** 启用骨架屏 */\n  enableSkeleton?: boolean\n  /** 启用缓存 */\n  enableCache?: boolean\n  /** 启用重试 */\n  enableRetry?: boolean\n  /** 启用自动保存 */\n  enableAutoSave?: boolean\n  /** 启用v-model */\n  enableVModel?: boolean\n  /** 强制刷新键 */\n  forceRefreshKey?: number\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  conditions: () => [],\n  context: () => ({}),\n  showSkeleton: true,\n  showDebug: false,\n  enableSkeleton: true,\n  enableCache: true,\n  enableRetry: true,\n  enableAutoSave: false,\n  enableVModel: false,\n  forceRefreshKey: 0\n})\n\nconst emit = defineEmits<{\n  (e: 'templateSelected', template: string | null): void\n  (e: 'rendered', data: any): void\n  (e: 'error', ...args: unknown[]): void\n  (e: 'save', data: any): void\n  (e: 'evaluationComplete', template: string | null): void\n}>()\n\n// 使用条件渲染\nconst {\n  selectedTemplate,\n  evaluating,\n  lastEvaluation,\n  context,\n  // selectTemplate, // Removing unused variable\n  reevaluate\n} = useTemplateCondition(props.conditions, props.context)\n\n// 模板键（用于强制刷新）\nconst templateKey = ref(0)\n\n/**\n * 处理重新评估\n */\nconst handleReevaluate = async () => {\n  const template = await reevaluate()\n  templateKey.value++\n  emit('evaluationComplete', template)\n}\n\n/**\n * 处理渲染完成\n */\nconst handleRendered = (data: any) => {\n  emit('rendered', data)\n}\n\n/**\n * 处理错误\n */\nconst handleError = (error: Error) => {\n  emit('error', error)\n}\n\n/**\n * 处理保存\n */\nconst handleSave = (data: any) => {\n  emit('save', data)\n}\n\n// 存储watchers以便清理\nconst watchers: Array<() => void> = []\n\n// 监听条件变化\nwatchers.push(\n  watch(() => props.conditions, async (_newConditions) => {\n    // 重新设置条件并评估\n    await handleReevaluate()\n  }, { deep: true })\n)\n\n// 监听上下文变化\nwatchers.push(\n  watch(() => props.context, (newContext) => {\n    context.value = newContext\n  }, { deep: true })\n)\n\n// 监听强制刷新键\nwatchers.push(\n  watch(() => props.forceRefreshKey, () => {\n    templateKey.value++\n  })\n)\n\n// 监听选中模板变化\nwatchers.push(\n  watch(selectedTemplate, (template) => {\n    emit('templateSelected', template)\n  })\n)\n\n// 初始化\nonMounted(() => {\n  // 如果初始上下文不同，更新它\n  if (props.context && Object.keys(props.context).length > 0) {\n    context.value = props.context\n  }\n})\n\n// 清理\nonUnmounted(() => {\n  // 停止所有watchers\n  watchers.forEach(unwatch => unwatch())\n  watchers.length = 0\n})\n</script>\n\n<template>\n  <div class=\"conditional-template\">\n    <!-- 加载状态 -->\n    <div v-if=\"evaluating && !selectedTemplate\" class=\"loading-state\">\n      <slot name=\"loading\">\n        <TemplateSkeleton v-if=\"showSkeleton\" />\n        <div v-else class=\"evaluating-message\">\n          正在选择最佳模板...\n        </div>\n      </slot>\n    </div>\n\n    <!-- 渲染选中的模板 -->\n    <TemplateRenderer\n      v-else-if=\"selectedTemplate\"\n      :key=\"templateKey\"\n      :template-name=\"selectedTemplate\"\n      category=\"dashboard\"\n      :data=\"data\"\n      :custom-components=\"customComponents\"\n      :enable-skeleton=\"enableSkeleton\"\n      :enable-cache=\"enableCache\"\n      :enable-retry=\"enableRetry\"\n      :enable-auto-save=\"enableAutoSave\"\n      :enable-v-model=\"enableVModel\"\n      @rendered=\"handleRendered\"\n      @error=\"handleError\"\n      @save=\"handleSave\"\n    />\n\n    <!-- 默认内容（无匹配模板） -->\n    <div v-else class=\"default-content\">\n      <slot name=\"default\">\n        <TemplateRenderer\n          v-if=\"defaultTemplate\"\n          :template-name=\"defaultTemplate\"\n          category=\"dashboard\"\n          :data=\"data\"\n          :custom-components=\"customComponents\"\n          :enable-skeleton=\"enableSkeleton\"\n          :enable-cache=\"enableCache\"\n          :enable-retry=\"enableRetry\"\n          :enable-auto-save=\"enableAutoSave\"\n          :enable-v-model=\"enableVModel\"\n          @rendered=\"handleRendered\"\n          @error=\"handleError\"\n          @save=\"handleSave\"\n        />\n        <div v-else class=\"no-template\">\n          <slot name=\"no-template\">\n            <p>没有匹配的模板</p>\n          </slot>\n        </div>\n      </slot>\n    </div>\n\n    <!-- 调试信息 -->\n    <div v-if=\"showDebug\" class=\"debug-info\">\n      <h4>条件渲染调试信息</h4>\n      <div class=\"debug-content\">\n        <div>选中模板: {{ selectedTemplate || '无' }}</div>\n        <div>评估时间: {{ lastEvaluation?.toLocaleString() || '未评估' }}</div>\n        <div>当前上下文:</div>\n        <pre>{{ JSON.stringify(context, null, 2) }}</pre>\n        <div>条件列表:</div>\n        <ul>\n          <li v-for=\"(condition, index) in conditions\" :key=\"index\">\n            {{ condition.description || condition.id || `条件 ${index + 1}` }}\n            - 模板: {{ condition.template }}\n            - 优先级: {{ condition.priority || 0 }}\n            - 状态: {{ condition.enabled !== false ? '启用' : '禁用' }}\n          </li>\n        </ul>\n      </div>\n      <button class=\"reevaluate-btn\" @click=\"handleReevaluate\">\n        重新评估条件\n      </button>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.conditional-template {\n  position: relative;\n}\n\n.loading-state {\n  padding: 20px;\n  text-align: center;\n}\n\n.evaluating-message {\n  color: #666;\n  font-size: 14px;\n  padding: 20px;\n}\n\n.default-content {\n  min-height: 100px;\n}\n\n.no-template {\n  padding: 40px;\n  text-align: center;\n  color: #999;\n  background: #f5f5f5;\n  border-radius: 4px;\n  border: 1px dashed #ddd;\n}\n\n.no-template p {\n  margin: 0;\n  font-size: 14px;\n}\n\n.debug-info {\n  margin-top: 20px;\n  padding: 15px;\n  background: #f8f9fa;\n  border: 1px solid #dee2e6;\n  border-radius: 4px;\n  font-size: 12px;\n}\n\n.debug-info h4 {\n  margin: 0 0 10px;\n  padding-bottom: 10px;\n  border-bottom: 1px solid #dee2e6;\n  font-size: 14px;\n  font-weight: 600;\n}\n\n.debug-content {\n  font-family: 'Consolas', 'Monaco', monospace;\n  line-height: 1.6;\n}\n\n.debug-content > div {\n  margin-bottom: 10px;\n}\n\n.debug-content pre {\n  margin: 5px 0;\n  padding: 10px;\n  background: white;\n  border: 1px solid #e1e4e8;\n  border-radius: 3px;\n  overflow-x: auto;\n  font-size: 11px;\n}\n\n.debug-content ul {\n  margin: 5px 0;\n  padding-left: 20px;\n  list-style: none;\n}\n\n.debug-content li {\n  margin-bottom: 5px;\n  padding: 5px 8px;\n  background: white;\n  border-left: 3px solid #007bff;\n  border-radius: 2px;\n}\n\n.reevaluate-btn {\n  margin-top: 10px;\n  padding: 6px 12px;\n  background: #007bff;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: background 0.2s;\n}\n\n.reevaluate-btn:hover {\n  background: #0056b3;\n}\n\n.reevaluate-btn:active {\n  transform: scale(0.95);\n}\n</style>"],"names":["props","__props","emit","__emit","selectedTemplate","evaluating","lastEvaluation","context","reevaluate","useTemplateCondition","conditions","templateKey","ref","handleReevaluate","template","value","handleRendered","data","handleError","error","handleSave","watchers","push","watch","_newConditions","deep","newContext","forceRefreshKey","onMounted","Object","keys","length","onUnmounted","forEach","unwatch","_openBlock","_createElementBlock","_hoisted_1","_createCommentVNode","_unref","_hoisted_2","_renderSlot","_ctx","showSkeleton","_createBlock","TemplateSkeleton","key","_hoisted_3","_Fragment","TemplateRenderer","category","customComponents","enableSkeleton","enableCache","enableRetry","enableAutoSave","enableVModel","onRendered","onError","onSave","_createElementVNode","_hoisted_4","defaultTemplate","_hoisted_5","_cache","showDebug","_hoisted_6","_hoisted_7","_toDisplayString","toLocaleString","JSON","stringify","_renderList","condition","index","description","id","priority","enabled","class","onClick"],"mappings":"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"}